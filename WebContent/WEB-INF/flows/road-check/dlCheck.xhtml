<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:sf="http://www.springframework.org/tags/faces"
	xmlns:hx="http://www.ibm.com/jsf/html_extended"
	xmlns:sec="http://www.springframework.org/security/tags"
	xmlns:p="http://primefaces.org/ui"
	xmlns:fsl="http://org.fsl.com">

	<ui:fragment id="page">	
				<p:panel  id="dlPanel" header="Driver's Licence Query Results" style="vertical-align: top; text-align:left;" rendered="true">  
	    				<p:panel rendered="#{initiateView.noDLFound}">
						<h:outputText value="No Drivers Licence Record found for DL No. " style="font-weight:bold;"/><h:outputText value="#{initiateView.dlNo}" style="font-weight:bold;"/>
					</p:panel>
	    				<p:panel  id="dlTopPan" style="vertical-align: top;" rendered="#{!initiateView.noDLFound}">  
	    					    				
	    				  			<p:panelGrid>
	    				  			<p:row style="border-bottom:1px solid black">
	    				  					<p:column colspan="4" >
	    				  						<hr></hr>
	    				  					</p:column>
	    				  				</p:row>
	    				  				<p:row>
	    				  					<p:column>
	    				  						<h:outputText value="NATIONALITY" style="font-weight:bold;"/>
	    				  					</p:column>
	    				  					
	    				  					<p:column colspan="2">
	    				  						<h:outputText value="DRIVER'S LICENCE # " style="font-weight:bold;"/>
	    				  					</p:column>
	    				  					
	    				  					<p:column rowspan="11">
	    				  						<h:graphicImage id="photo2" width="120" height="143" border="0"
													url="#{recordOffenceOutcomeView.dlPhotoURL}" alt="No Image" style="display: inline-block; border:3px solid #dddddd;" />
	    				  			
	    				  					</p:column>
	    				  				</p:row>
	    				  				
	    				  				<p:row>
	    				  					<p:column>
	    				  						<h:outputText value="#{dlResult.nationality}" />
	    				  					</p:column>
	    				  					<p:column colspan="2">
	    				  						<h:outputText value="#{dlResult.dlNo} " />
	    				  					</p:column>
	    				  				</p:row>
	    				  				<p:row>
	    				  				<p:column colspan="3">
	    				  					
	    				  					</p:column>
	    				  				</p:row>
	    				  				<p:row>
	    				  					<p:column>
	    				  						<h:outputText value="CLASS " style="font-weight:bold;"/>
	    				  					</p:column>
	    				  					<p:column>
	    				  						<h:outputText value="TRN " style="font-weight:bold;"/>
	    				  					</p:column>
	    				  					<p:column>
	    				  						<h:outputText value="COLLECTORATE " style="font-weight:bold;"/>
	    				  					</p:column>
	    				  				</p:row>
	    				  				<p:row>
	    				  					<p:column>
	    				  						<h:outputText value="#{dlResult.dlClass}" />
	    				  					</p:column>
	    				  					<p:column>
	    				  						<h:outputText value="#{dlResult.trnNo} " />
	    				  					</p:column>
	    				  					<p:column >
	    				  						<h:outputText value="#{dlResult.collectorateIssued}" />
	    				  					</p:column>
	    				  				</p:row>
	    				  				<p:row>
	    				  					<p:column colspan="3">
	    				  					
	    				  					</p:column>
	    				  					
	    				  				</p:row>
	    				  				<p:row>
	    				  					<p:column>
	    				  						<h:outputText value="DATE ISSUED " style="font-weight:bold;"/>
	    				  					</p:column>
	    				  					<p:column colspan="2">
	    				  						<h:outputText value="ORIGINAL DATE OF ISSUE" style="font-weight:bold;"/>
	    				  					</p:column>
	    				  				</p:row>
	    				  				<p:row>
	    				  					<p:column>
	    				  						<h:outputText value="#{roadCheckServiceAction.formatDate(dlResult.issueDate)}" />
	    				  					</p:column>
	    				  					<p:column colspan="2">
	    				  						<h:outputText value="#{dlResult.dateFirstIssued}" />
	    				  					</p:column>
	    				  				</p:row>
	    				  				<p:row>
	    				  				<p:column colspan="3">
	    				  					
	    				  					</p:column>
	    				  				</p:row>
	    				  				<p:row>
	    				  					<p:column>
	    				  						<h:outputText value="EXPIRY DATE " style="font-weight:bold;"/>
	    				  					</p:column>
	    				  					<p:column>
	    				  						<h:outputText value="BIRTH DATE " style="font-weight:bold;"/>
	    				  					</p:column>
	    				  					<p:column >
	    				  						<h:outputText value="SEX " style="font-weight:bold;"/>
	    				  					</p:column>
	    				  				</p:row>
	    				  				<p:row>
	    				  					<p:column>
	    				  						<h:outputText value="#{roadCheckServiceAction.formatDate(dlResult.expiryDate)} "  styleClass="#{initiateView.dlCkFl ? 'expiredDate' : ''}"/>
	    				  					</p:column>
	    				  					<p:column>
	    				  						<h:outputText value="#{dlResult.dateOfBirth}" />
	    				  					</p:column>
	    				  					<p:column>
	    				  						<h:outputText value="#{dlResult.gender}" />
	    				  					</p:column>
	    				  				</p:row>
	    				  				<p:row style="border-bottom:1px solid black">
	    				  					<p:column colspan="4" >
	    				  						<hr></hr>
	    				  					</p:column>
	    				  				</p:row>
	    				  				<p:row>
	    				  					<p:column colspan="2" >
	    				  						<h:outputText value="NAME" style="font-weight:bold;"/>
	    				  					</p:column>
	    				  					<p:column>
	    				  						<h:outputText value="ADDRESS " style="font-weight:bold;"/>
	    				  					</p:column>
	    				  				</p:row>
	    				  				
	    				  				<p:row>
	    				  					<p:column colspan="2" >
	    				  						<h:outputText value="#{dlResult.lastName}"/>
	    				  					</p:column>
	    				  					<p:column colspan="2">
	    				  						<h:outputText value="#{roadCheckServiceAction.getAddressLine1(dlResult.address.streetName,dlResult.address.mark,
					  				dlResult.address.streetNumber)}"/>
	    				  					</p:column>
	    				  				</p:row>
	    				  				
	    				  				<p:row>
	    				  					<p:column colspan="2" >
	    				  						<h:outputText value="#{dlResult.firstName}"/> <h:outputText value="  "/>	    				  						
	    				  						<c:if test="#{not empty dlResult.middleName}">
	    				  							<h:outputText value="#{dlResult.middleName.charAt(0)}"/>
	    				  						</c:if>
	    				  					</p:column>
	    				  					<p:column colspan="2">
	    				  						<h:outputText value="#{roadCheckServiceAction.getAddressLine2(dlResult.address.poBoxNumber,dlResult.address.poLocation,
					  				dlResult.address.parish)}"/>
	    				  					</p:column>
	    				  				</p:row>
	    				  				
	    				  					    				  				
	    				  				<p:row>
	    				  					<p:column colspan="3" >
	    				  						<h:outputText value="LICENCE TO DRIVE" style="font-weight:bold;"/>
	    				  					</p:column>
	    				  					
	    				  				</p:row>
	    				  				<p:row>
	    				  					<p:column colspan="3" >
	    				  						<h:outputText value="#{dlResult.vehicleLicencedToDrive}"/>
	    				  					</p:column>
	    				  					
	    				  				</p:row>
	    				  				<p:row style="border-bottom:1px solid black">
	    				  					<p:column colspan="4" >
	    				  						<hr></hr>
	    				  					</p:column>
	    				  				</p:row>
	    				  	</p:panelGrid>
	    					
	    				</p:panel>
	    				
	    				
	    				
	    				<br/>
	    				 <div align="left">
	    				<h:outputText value="Indicate Action to be taken " style="font-weight:bold;"/> <br/>
	    			 <p:selectOneRadio id="customRadioDL" value="#{recordOffenceOutcomeView.dlActionToBeTaken}" style="margin-bottom: 0px;">  
	      					  <f:selectItem itemLabel="All is in Order" itemValue="A" itemDisabled="#{initiateView.noDLFound?'true':'false'}"/>  
	      					  <f:selectItem itemLabel="Record Offences and Outcomes" itemValue="R" />    
	      					  <p:ajax oncomplete="addDLRowOnComplete(); updateDLTable();" listener="#{roadCheckServiceAction.indicateActionDL}" update=":recordOffenceOutcome:tabV:panelDataTableDL :recordOffenceOutcome:panelButtons"></p:ajax> 
	  					  </p:selectOneRadio>  
	  					  </div>
	  					  
	  					  
	  					 <br/>
	  					 <p:panel id="panelDataTableDLErr">
						<h:outputText value="#{recordOffenceOutcomeView.dlTableError}" id="dlTableErr" style="display:none"/> 
						<h:outputText value="#{dlOffenceList.size()}" id="dlOffListSize" style="display:none"/> 
						 <h:outputText value="#{recordOffenceOutcomeView.dlOpenRecordCount}" style="display:none"/>
						</p:panel>
						<p:panel id="panelMsgDL">
						<p:messages id="msgMV" closable="true"/>
						</p:panel>
	    			 <p:panel id="panelDataTableDL">
	    			 
	    			 	<p:panel rendered="#{recordOffenceOutcomeView.dlActionToBeTaken=='R' &amp;&amp; dlOffenceList.size() == 0}">
	    			 		<h:outputText value="No Offence related to Driver's Licence Check" style="font-weight:bold;"/>
	    			 	</p:panel>
	  					  
	  					  <p:dataTable var="offOutcome" value="#{dlOffenceOutcomes}" editable="true" rendered="#{recordOffenceOutcomeView.dlActionToBeTaken=='R' &amp;&amp; dlOffenceList.size() > 0}"
	  					   rows="50" id="dlOffenceOutcomeList" >  
  
						       <f:facet name="header" >  
						           <div align="left">
						             <h:outputText value=" Offences/Outcomes Observed " style="padding-right:30px"/>  
						           <p:commandButton icon="ui-icon-plusthick" id="addDLBtn"  value="Add" action="dlAddOffenceOutcome" processIds="*"  ajax="true" style="padding-right:20px" oncomplete="addDLRowOnComplete();" update=":recordOffenceOutcome:tabV:panelDataTableDL" disabled="#{recordOffenceOutcomeView.dlOpenRecordCount > 0 || dlOffenceList.size() == dlOffenceOutcomes.size()}"/>
						           <p:commandButton icon="ui-icon-trash"  id="deleteDLBtn"  value="Delete" action="dlDeleteOffenceOutcome" processIds="*"  ajax="true" update=":recordOffenceOutcome:tabV:panelDataTableDL :recordOffenceOutcome:panelButtons" disabled="#{!recordOffenceOutcomeView.dlOffenceOutcomeSelected || recordOffenceOutcomeView.dlOpenRecordCount > 0 || dlOffenceOutcomes.size() == 0}"
						           	/>
						           </div>
						           
						       </f:facet>  
						 
						 		<p:ajax event="rowEditInit"  listener="#{roadCheckServiceAction.initRowEditDL}" oncomplete="updateDLTable();disablePenDL(); disableCheckBoxDL(); "/> 
						 		  <p:ajax event="rowEdit" listener="#{roadCheckServiceAction.editDLSelectedOffenceOutcome}"  update=":recordOffenceOutcome:tabV:panelMsgDL :recordOffenceOutcome:tabV:dlTableErr" oncomplete="updateDLTableEdit();editAndCancelHideDL();" />  
						       <p:ajax event="rowEditCancel" listener="#{roadCheckServiceAction.cancelDLEditSelectedOffenceOutcome}" update=":recordOffenceOutcome:tabV:panelMsgDL" oncomplete="updateDLTable();selectDLAll();cancelHideDL();" />  
						       
						 		  <p:column  style="width:6%;" id="checkBoxes">  
						         <f:facet  name="header">
									 <p:selectBooleanCheckbox id="dlSelectAllBox" value="#{recordOffenceOutcomeView.dlSelectAllOffenceOutcome}" onchange="selectDLAll();" disabled="#{recordOffenceOutcomeView.dlOpenRecordCount > 0}">
									 		
									 </p:selectBooleanCheckbox> 
									</f:facet>
						                <p:selectBooleanCheckbox value="#{offOutcome.rowSelected}" styleClass="ui-corner-checkbox">
						                <p:ajax oncomplete="selectDLRow();" />
						                </p:selectBooleanCheckbox>  
						            
						       </p:column>  
						     
						       <p:column headerText="Offence(s)" style="width:41%; text-align:left">  
						         
						                  <p:cellEditor>  
						               <f:facet name="output">  
						             	 <h:outputText value="#{offOutcome.offenceShortDescription}" /> 
						               </f:facet>  
						               <f:facet name="input">  
						                  <p:selectOneMenu style="width:100%"
								id="comboOffenceInput" value="#{offOutcome.offenceId}">
								<f:selectItem itemValue="" itemLabel="[Select One]" />
								<f:selectItems var="offence" itemValue="#{offence.offenceId}" itemLabel="#{offence.shortDescription}" value="#{dlOffenceList}" />
									</p:selectOneMenu>  
						               </f:facet>  
						           </p:cellEditor>
						            
						       </p:column>  
						        <p:column headerText="Issue Summons" style="width:10%">  
						           <p:cellEditor>  
						               <f:facet name="output">  
						                   <f:subview rendered="#{offOutcome.issueSummons}">
												<i class="icon icon-check icon-1x"></i>
											</f:subview>
						               </f:facet>  
						               <f:facet name="input">  
						                   <p:selectBooleanCheckbox value="#{offOutcome.issueSummons}" />  
						               </f:facet>  
						           </p:cellEditor>  
						       </p:column> 
						        <p:column headerText="Issue Warning Notice" style="width:10%">  
						           <p:cellEditor>  
						               <f:facet name="output">    
						                   <f:subview rendered="#{offOutcome.issuewWarningNotice}">
												<i class="icon icon-check icon-1x"></i>
											</f:subview>
						               </f:facet>  
						               <f:facet name="input">  
						                   <p:selectBooleanCheckbox value="#{offOutcome.issuewWarningNotice}" />  
						               </f:facet>  
						           </p:cellEditor>  
						       </p:column>  
						       <p:column headerText="Warning No Prosecution" style="width:10%">  
						           <p:cellEditor>  
						               <f:facet name="output">  
						                   <f:subview rendered="#{offOutcome.issueWarningNP}">
												<i class="icon icon-check icon-1x"></i>
											</f:subview>
						               </f:facet>  
						               <f:facet name="input">  
						                   <p:selectBooleanCheckbox value="#{offOutcome.issueWarningNP}" />  
						               </f:facet>  
						           </p:cellEditor>  
						       </p:column> 
						       <p:column headerText="Warning For Prosecution" style="width:10%">  
						           <p:cellEditor>  
						               <f:facet name="output">   
						                    <f:subview rendered="#{offOutcome.warnForProsecution}">
												<i class="icon icon-check icon-1x"></i>
											</f:subview>
						               </f:facet>  
						               <f:facet name="input">  
						                   <p:selectBooleanCheckbox value="#{offOutcome.warnForProsecution}" />  
						               </f:facet>  
						           </p:cellEditor>  
						       </p:column>
<!-- 						        <p:column headerText="Remove Plate" style="width:10%">   -->
<!-- 						           <p:cellEditor>   -->
<!-- 						               <f:facet name="output">    -->
<!-- 						                     <f:subview rendered="#{offOutcome.removePlate}"> -->
<!-- 												<i class="icon icon-check icon-1x"></i> -->
<!-- 											</f:subview> -->
<!-- 						               </f:facet>   -->
						             
<!-- 						               <f:facet name="input">   -->
<!-- 						                   <p:selectBooleanCheckbox value="#{offOutcome.removePlate}" disabled="#{initiateView.activityType == 'U'}"/>   -->
<!-- 						               </f:facet>   -->
<!-- 						           </p:cellEditor>   -->
<!-- 						       </p:column>  -->
						       
						         <p:column >  
           							 <p:rowEditor id="dlRowEditor"/>  
           							 <p:tooltip for="dlRowEditor" value="Click to Add/Edit" showEffect="fade" hideEffect="fade" /> 
        							</p:column>  
						   </p:dataTable>
						   
						   <p:commandButton wigetVar="allBtnSelDl" id="allSelectBtnDL" value="Do select" style="display:none" processIds="*" action="dlSelectAllOffenceOutcome" 
			 ajax="true" update=":recordOffenceOutcome:tabV:panelDataTableDL" ></p:commandButton>
			 
			    <p:commandButton wigetVar="selBtnSelDL" id="selectBtnDLRow" value="Do select" style="display:none" processIds="*" action="dlSelectRowOffenceOutcome" 
			 ajax="true" update=":recordOffenceOutcome:tabV:panelDataTableDL" ></p:commandButton>
			
			 
			 <p:commandButton wigetVar="updateDLTableVar" id="updateDLTable" value="Do select2" style="display:none" processIds="*" 
			 	ajax="true" update=":recordOffenceOutcome:tabV:panelDataTableDLErr :recordOffenceOutcome:tabV:dlOffenceOutcomeList:addDLBtn :recordOffenceOutcome:tabV:dlOffenceOutcomeList:deleteDLBtn :recordOffenceOutcome:tabV:dlOffenceOutcomeList:dlSelectAllBox :recordOffenceOutcome:panelButtons :recordOffenceOutcome:progressPanel "
			 	>
			 </p:commandButton>
			
			 <h:inputText id="hiddendlCkFl" style="display:none" value="#{initiateView.dlCkFl}" ></h:inputText>
 			
 						
 				
			 <script>
			  
			//<![CDATA[
			    function selectDLRow(){
			    $("button[id*='selectBtnDLRow']").click();	
			    }
			    
			 	function selectDLAll(){
			 	$("button[id*='allSelectBtnDL']").click()			 	
			 	}
			 	function addDLRowOnComplete() {
			 		var x = $('[name="recordOffenceOutcome:tabV:customRadioDL"]:checked').val();
			 		var y = $('#recordOffenceOutcome\\:tabV\\:dlOffListSize').text();
			 		if((x=='R') && (y > 0)){
			 			jQuery('#recordOffenceOutcome\\:tabV\\:dlOffenceOutcomeList\\:0\\:dlRowEditor .ui-icon-pencil')[0].id = 'dlPencilEdit';
			 		 	jQuery('#dlPencilEdit').trigger('click');
			 		}
			 	}
			 	
			 	
			 	function updateDLTableEdit(){
			 		var x = $('#recordOffenceOutcome\\:tabV\\:dlTableErr').text().trim();
			 		
			 		if(x=='false'){
				 		$("button[id*='updateDLTable']").click();	
			 		}
				 }
			 	
			 	function updateDLTable(){
				 		$("button[id*='updateDLTable']").click();	
				 }
			 	
			 	function disableCheckBoxDL(){
			 		
			 		 
			 		$('#recordOffenceOutcome\\:tabV\\:dlOffenceOutcomeList .ui-corner-checkbox').each(function(){
			        	 $(this).css('display','none');
			        	 });
			 		
	        	 }
			 	function disablePenDL(){
		        	 $('#recordOffenceOutcome\\:tabV\\:dlOffenceOutcomeList .ui-icon-pencil').each(function(){
		        	 $(this).css('display','none');
		        	 });
	        	 }
			 	function cancelHideDL(){
		        	 $('#recordOffenceOutcome\\:tabV\\:dlOffenceOutcomeList .ui-icon-pencil').each(function(){
		        	 //$(').addClass('rat');
		        	 // $(this).css({backgroundColor: '#0099ff'});
		        	 $(this).css('display','');
		        	 });
		        	 
		        	 $('#recordOffenceOutcome\\:tabV\\:dlOffenceOutcomeList .ui-corner-checkbox').each(function(){
			        	 $(this).css('display','');
			        	 });
	        	 }
	        	 
	        	 function editAndCancelHideDL(){
				 		var x = $('#recordOffenceOutcome\\:tabV\\:dlTableErr').text().trim();
				 		//alert(x);
				 		if(x=='false'){
				 			cancelHideDL();
				 		}
					 }
	        	 
	        	//]]>
			 </script>
			
			 </p:panel>
			 
			  <script>
			//<![CDATA[	 
			 $(document).ready( function() { 
		       
		           var chkDLFl = $('input[id*="hiddendlCkFl"]').val();
		          		           
		    	   if(chkDLFl && $('div[id*=panelDataTableDL]').find('table').find('tbody').find('tr[class*=empty]').size() != 0)
		    		{   
		    		   
		    	   		$("button[id*='addDLBtn']").click();
		    		   
		    		}
		          });
			 
			//]]>
			 </script>
			 
			 
	    			</p:panel>
	    			
	  	
</ui:fragment>
</ui:composition>